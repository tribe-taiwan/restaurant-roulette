<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš ï¸ éæ™‚APIè­¦å‘Š - é¤å»³è½‰ç›¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .warning-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            animation: shake 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes shake {
            0% { transform: translateX(0px) }
            100% { transform: translateX(2px) }
        }
        
        .warning-header {
            background: #ff4757;
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .warning-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: stripes 2s linear infinite;
        }
        
        @keyframes stripes {
            0% { transform: translateX(-20px) }
            100% { transform: translateX(20px) }
        }
        
        .warning-icon {
            font-size: 80px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .warning-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .warning-subtitle {
            font-size: 18px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .warning-content {
            padding: 40px;
        }
        
        .issue-summary {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .issue-count {
            font-size: 24px;
            font-weight: bold;
            color: #e53e3e;
            margin-bottom: 15px;
        }
        
        .severity-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
        }
        
        .severity-high {
            background: #ff4757;
            color: white;
        }
        
        .severity-medium {
            background: #ffa502;
            color: white;
        }
        
        .severity-low {
            background: #2ed573;
            color: white;
        }
        
        .issues-detail {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .issue-item {
            background: white;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        
        .issue-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .issue-description {
            color: #4a5568;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .issue-location {
            background: #edf2f7;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-danger {
            background: #ff4757;
            color: white;
        }
        
        .btn-danger:hover {
            background: #ff3742;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffa502;
            color: white;
        }
        
        .btn-warning:hover {
            background: #ff9500;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #2ed573;
            color: white;
        }
        
        .btn-success:hover {
            background: #26d068;
            transform: translateY(-2px);
        }
        
        .developer-note {
            background: #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            font-style: italic;
            color: #4a5568;
        }
        
        .developer-note code {
            background: #2d3748;
            color: #68d391;
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .disable-instructions {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-style: normal;
        }
        
        .blinking {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="warning-container">
        <div class="warning-header">
            <div class="warning-icon">âš ï¸ğŸš¨</div>
            <div class="warning-title blinking">éæ™‚APIæª¢æ¸¬è­¦å‘Š</div>
            <div class="warning-subtitle">ç™¼ç¾AIç”Ÿæˆçš„éæ™‚Google Places APIèªæ³•</div>
        </div>
        
        <div class="warning-content">
            <div class="issue-summary">
                <div class="issue-count" id="issue-count">æ­£åœ¨æƒæ...</div>
                <div id="severity-badges"></div>
            </div>
            
            <div class="issues-detail" id="issues-detail">
                <div style="text-align: center; color: #718096;">
                    ğŸ” æ­£åœ¨æƒæä»£ç¢¼ä¸­çš„éæ™‚APIèªæ³•...
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-danger" onclick="copyDetailedReport()">
                    ğŸ“‹ è¤‡è£½è©³ç´°å ±å‘Š
                </button>
                <button class="btn btn-warning" onclick="forceIgnoreWarning()">
                    âš ï¸ å¿½ç•¥è­¦å‘Š (ä¸å»ºè­°)
                </button>
                <button class="btn btn-success" onclick="recheckCode()">
                    ğŸ”„ é‡æ–°æª¢æŸ¥
                </button>
            </div>
            
            <div class="developer-note">
                <strong>çµ¦é–‹ç™¼è€…çš„æé†’ï¼š</strong><br>
                é€™å€‹è­¦å‘Šæ˜¯ç‚ºäº†é˜²æ­¢AIåŠ©æ‰‹å¯«å…¥Google Places APIçš„éæ™‚èªæ³•ã€‚
                å»ºè­°ç«‹å³ä¿®å¾©é€™äº›å•é¡Œï¼Œä»¥ç¢ºä¿æ‡‰ç”¨ç¨‹å¼çš„é•·æœŸç©©å®šæ€§ã€‚
                å¸¸è¦‹çš„éæ™‚èªæ³•åŒ…æ‹¬ï¼šopen_nowã€permanently_closedã€utc_offset ç­‰ã€‚
                
                <div class="disable-instructions">
                    <strong>ğŸ› ï¸ å¦‚ä½•æ°¸ä¹…é—œé–‰æ­¤æª¢æŸ¥ï¼š</strong><br>
                    1. ç·¨è¼¯æª”æ¡ˆï¼š<code>utils/deprecatedApiChecker.js</code><br>  
                    2. ä¿®æ”¹ç¬¬7è¡Œï¼š<code>ENABLE_DEPRECATED_API_CHECK = true</code><br>
                    3. æ”¹ç‚ºï¼š<code>ENABLE_DEPRECATED_API_CHECK = false</code><br>
                    4. å„²å­˜æª”æ¡ˆä¸¦é‡æ–°æ•´ç†é é¢
                </div>
            </div>
        </div>
    </div>

    <script src="./utils/deprecatedApiChecker.js"></script>
    <script>
        let currentCheckResult = null;
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œæª¢æŸ¥
        window.addEventListener('DOMContentLoaded', async () => {
            // å…ˆå˜—è©¦å¾ sessionStorage è®€å–æª¢æŸ¥çµæœ
            const savedResult = sessionStorage.getItem('deprecated_api_check_result');
            if (savedResult) {
                try {
                    currentCheckResult = JSON.parse(savedResult);
                    updateDisplay(currentCheckResult);
                    return;
                } catch (error) {
                    console.warn('ç„¡æ³•è§£æå„²å­˜çš„æª¢æŸ¥çµæœ:', error);
                }
            }
            
            // å¦‚æœæ²’æœ‰å„²å­˜çš„çµæœï¼ŒåŸ·è¡Œæ–°çš„æª¢æŸ¥
            await performCheck();
        });
        
        async function performCheck() {
            try {
                currentCheckResult = await window.DeprecatedApiChecker.performFullCheck();
                updateDisplay(currentCheckResult);
                
                // å„²å­˜æª¢æŸ¥çµæœ
                sessionStorage.setItem('deprecated_api_check_result', JSON.stringify(currentCheckResult));
            } catch (error) {
                console.error('æª¢æŸ¥å¤±æ•—:', error);
                document.getElementById('issues-detail').innerHTML = 
                    '<div style="color: #e53e3e; text-align: center;">âŒ æª¢æŸ¥éç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æ‰‹å‹•æª¢æŸ¥ä»£ç¢¼</div>';
            }
        }
        
        function updateDisplay(checkResult) {
            const issueCountEl = document.getElementById('issue-count');
            const severityBadgesEl = document.getElementById('severity-badges');
            const issuesDetailEl = document.getElementById('issues-detail');
            
            if (!checkResult.hasIssues) {
                // æ²’æœ‰å•é¡Œï¼Œ3ç§’å¾Œè‡ªå‹•è·³è½‰
                issueCountEl.textContent = 'âœ… æœªç™¼ç¾éæ™‚APIèªæ³•';
                issueCountEl.style.color = '#2ed573';
                issuesDetailEl.innerHTML = 
                    '<div style="color: #2ed573; text-align: center;">ğŸ‰ ä»£ç¢¼æª¢æŸ¥é€šéï¼3ç§’å¾Œè‡ªå‹•è·³è½‰åˆ°ä¸»é é¢...</div>';
                
                setTimeout(() => {
                    window.location.href = './index.html';
                }, 3000);
                return;
            }
            
            // æœ‰å•é¡Œï¼Œé¡¯ç¤ºè©³ç´°è³‡è¨Š
            issueCountEl.textContent = `ç™¼ç¾ ${checkResult.summary.totalIssues} å€‹éæ™‚APIå•é¡Œ`;
            
            // é¡¯ç¤ºåš´é‡æ€§æ¨™ç±¤
            let badgesHtml = '';
            if (checkResult.summary.severityCount.high > 0) {
                badgesHtml += `<span class="severity-badge severity-high">é«˜å±éšª ${checkResult.summary.severityCount.high} å€‹</span>`;
            }
            if (checkResult.summary.severityCount.medium > 0) {
                badgesHtml += `<span class="severity-badge severity-medium">ä¸­ç­‰ ${checkResult.summary.severityCount.medium} å€‹</span>`;
            }
            if (checkResult.summary.severityCount.low > 0) {
                badgesHtml += `<span class="severity-badge severity-low">è¼•å¾® ${checkResult.summary.severityCount.low} å€‹</span>`;
            }
            severityBadgesEl.innerHTML = badgesHtml;
            
            // é¡¯ç¤ºå•é¡Œè©³ç´°è³‡è¨Š
            let detailHtml = '';
            checkResult.issues.forEach(issue => {
                detailHtml += `
                    <div class="issue-item">
                        <div class="issue-title">ğŸš¨ ${issue.pattern} (${issue.file})</div>
                        <div class="issue-description">${issue.description}</div>
                `;
                
                issue.locations.forEach(loc => {
                    detailHtml += `<div class="issue-location">ç¬¬${loc.line}è¡Œ: ${loc.content}</div>`;
                });
                
                detailHtml += '</div>';
            });
            issuesDetailEl.innerHTML = detailHtml;
        }
        
        async function copyDetailedReport() {
            if (!currentCheckResult) {
                alert('âŒ æ²’æœ‰æª¢æŸ¥çµæœå¯è¤‡è£½');
                return;
            }
            
            try {
                const report = window.DeprecatedApiChecker.formatReport(currentCheckResult);
                
                // ç”Ÿæˆé©åˆè²¼çµ¦AIçš„æ ¼å¼åŒ–å ±å‘Š
                const aiReport = `
ğŸš¨ éæ™‚APIæª¢æ¸¬å ±å‘Š ğŸš¨

æª¢æ¸¬åˆ° ${currentCheckResult.summary.totalIssues} å€‹éæ™‚Google Places APIå•é¡Œï¼š

${currentCheckResult.summary.severityCount.high > 0 ? `ğŸ”´ é«˜å±éšªæ€§: ${currentCheckResult.summary.severityCount.high} å€‹` : ''}
${currentCheckResult.summary.severityCount.medium > 0 ? `ğŸŸ¡ ä¸­ç­‰å±éšªæ€§: ${currentCheckResult.summary.severityCount.medium} å€‹` : ''}
${currentCheckResult.summary.severityCount.low > 0 ? `ğŸŸ¢ ä½å±éšªæ€§: ${currentCheckResult.summary.severityCount.low} å€‹` : ''}

è©³ç´°å•é¡Œåˆ—è¡¨ï¼š
${currentCheckResult.issues.map(issue => 
`
æª”æ¡ˆ: ${issue.file}
å•é¡Œ: ${issue.pattern} (${issue.matches}è™•)
èªªæ˜: ${issue.description}
ä½ç½®: ${issue.locations.map(loc => `ç¬¬${loc.line}è¡Œ: ${loc.content}`).join(', ')}
`).join('\n')}

è«‹ä¿®å¾©é€™äº›éæ™‚çš„Google Places APIèªæ³•ï¼Œç¢ºä¿æ‡‰ç”¨ç¨‹å¼çš„é•·æœŸç©©å®šæ€§ã€‚

å¸¸è¦‹ä¿®å¾©æ–¹æ¡ˆï¼š
- open_now â†’ ä½¿ç”¨ opening_hours.isOpen() æˆ– business_status
- permanently_closed â†’ ä½¿ç”¨ business_status  
- utc_offset â†’ ä½¿ç”¨ utc_offset_minutes
`;

                // è¤‡è£½åˆ°å‰ªè²¼ç°¿
                await navigator.clipboard.writeText(aiReport);
                
                // æ›´æ–°æŒ‰éˆ•æ–‡å­—æç¤ºæˆåŠŸ
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = 'âœ… å·²è¤‡è£½ï¼';
                button.style.background = '#2ed573';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#ff4757';
                }, 2000);
                
            } catch (error) {
                console.error('è¤‡è£½å¤±æ•—:', error);
                
                // å‚™ç”¨æ–¹æ¡ˆï¼šé¡¯ç¤ºåœ¨å½ˆçª—ä¸­è®“ç”¨æˆ¶æ‰‹å‹•è¤‡è£½
                const report = window.DeprecatedApiChecker.formatReport(currentCheckResult);
                const textarea = document.createElement('textarea');
                textarea.value = report;
                textarea.style.position = 'fixed';
                textarea.style.top = '0';
                textarea.style.left = '0';
                textarea.style.width = '1px';
                textarea.style.height = '1px';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    alert('âœ… å ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                } catch (fallbackError) {
                    alert('âŒ ç„¡æ³•è‡ªå‹•è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹å…§å®¹ï¼š\n\n' + report);
                }
                
                document.body.removeChild(textarea);
            }
        }
        
        function forceIgnoreWarning() {
            // è¨­ç½®æœƒè©±ç´šåˆ¥çš„å¿½ç•¥æ¨™è¨˜ï¼ˆç›´åˆ° Ctrl+Shift+R é‡æ–°æ•´ç†ï¼‰
            sessionStorage.setItem('deprecated_api_warning_ignored_session', 'true');
            window.location.href = './index.html';
        }
        
        async function recheckCode() {
            document.getElementById('issues-detail').innerHTML = 
                '<div style="text-align: center; color: #718096;">ğŸ” æ­£åœ¨é‡æ–°æƒæ...</div>';
            await performCheck();
        }
    </script>
</body>
</html>
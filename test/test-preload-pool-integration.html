<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é è¼‰å…¥æ± æ•´åˆæ¸¬è©¦</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/keen-slider@6.8.6/keen-slider.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/keen-slider@6.8.6/keen-slider.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --theme-primary: #3b82f6;
            --theme-accent: #10b981;
            --accent-color: #fbbf24;
            --image-overlay-opacity: 0.3;
        }
        
        .keen-slider {
            position: relative;
        }
        
        .keen-slider__slide {
            min-height: 256px;
        }
        
        .restaurant-card {
            transition: all 0.3s ease;
        }
        
        .glow-container {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-4">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">é è¼‰å…¥æ± æ•´åˆæ¸¬è©¦</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- SlotMachine Component -->
            <div>
                <h2 class="text-xl font-bold mb-4">è€è™æ©Ÿçµ„ä»¶</h2>
                <div id="slot-machine-container"></div>
            </div>
            
            <!-- Test Controls -->
            <div>
                <h2 class="text-xl font-bold mb-4">æ¸¬è©¦æ§åˆ¶</h2>
                <div class="space-y-4">
                    <button class="btn bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded" onclick="loadTestRestaurant()">è¼‰å…¥æ¸¬è©¦é¤å»³</button>
                    <button class="btn bg-green-600 hover:bg-green-700 px-4 py-2 rounded" onclick="triggerPreloadPool()">è§¸ç™¼é è¼‰å…¥æ± </button>
                    <button class="btn bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded" onclick="checkPreloadStatus()">æª¢æŸ¥é è¼‰å…¥ç‹€æ…‹</button>
                    <button class="btn bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded" onclick="simulateBackgroundRefill()">æ¨¡æ“¬å¹•å¾Œè£œå……</button>
                </div>
                
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-2">æ¸¬è©¦ç‹€æ…‹</h3>
                    <div id="test-status" class="bg-gray-800 p-4 rounded text-sm font-mono"></div>
                </div>
                
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-2">é è¼‰å…¥æ± ç‹€æ…‹</h3>
                    <div id="preload-status" class="bg-gray-800 p-4 rounded text-sm font-mono"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock global functions for testing
        window.getAvailableRestaurantsFromCache = function(selectedMealTime) {
            return Promise.resolve([
                {
                    id: 'test-1',
                    name: 'æ¸¬è©¦é¤å»³ 1',
                    name_zh: 'æ¸¬è©¦é¤å»³ 1',
                    image: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400',
                    rating: 4.5,
                    distance: '0.5',
                    place_id: 'test-place-1'
                },
                {
                    id: 'test-2',
                    name: 'æ¸¬è©¦é¤å»³ 2',
                    name_zh: 'æ¸¬è©¦é¤å»³ 2',
                    image: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400',
                    rating: 4.2,
                    distance: '0.8',
                    place_id: 'test-place-2'
                },
                {
                    id: 'test-3',
                    name: 'æ¸¬è©¦é¤å»³ 3',
                    name_zh: 'æ¸¬è©¦é¤å»³ 3',
                    image: 'https://images.unsplash.com/photo-1551218808-94e220e084d2?w=400',
                    rating: 4.8,
                    distance: '1.2',
                    place_id: 'test-place-3'
                }
            ]);
        };

        window.getRestaurantHistory = function() {
            return [];
        };

        window.getRandomRestaurant = function(userLocation, selectedMealTime, config) {
            console.log('ğŸ” æ¨¡æ“¬å¹•å¾Œè£œå……é¤å»³', config);
            return Promise.resolve({
                id: 'background-' + Date.now(),
                name: 'å¹•å¾Œè£œå……é¤å»³',
                name_zh: 'å¹•å¾Œè£œå……é¤å»³',
                image: 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400',
                rating: 4.0,
                distance: '2.0',
                place_id: 'background-place-' + Date.now()
            });
        };

        // Mock utility functions
        window.createTouchHandlers = () => ({});
        window.createButtonLogic = () => ({
            handleSpinClick: () => console.log('Spin clicked'),
            isAddButtonDisabled: () => false,
            handleAddCandidateClick: () => console.log('Add candidate clicked'),
            getAddButtonStyle: () => ({ background: 'blue', borderColor: 'blue' }),
            getAddButtonIcon: () => 'â•',
            getAddButtonText: () => 'åŠ å…¥å€™é¸'
        });
        window.createShareButtonLogic = () => ({
            handleShareClick: () => console.log('Share clicked'),
            getShareButtonStyle: () => ({ background: 'green', borderColor: 'green' }),
            getShareButtonIcon: () => 'ğŸ“¤',
            getShareButtonText: () => 'åˆ†äº«'
        });
        window.createKeyboardHandler = () => ({
            setupKeyboardListeners: () => () => {}
        });
        window.getPriceLabels = () => ({ zh: {}, en: {} });
        window.renderStars = () => [];
        window.getDirectionsUrl = () => '#';

        // Test data
        let currentRestaurant = {
            id: 'current-test',
            name: 'ç•¶å‰æ¸¬è©¦é¤å»³',
            name_zh: 'ç•¶å‰æ¸¬è©¦é¤å»³',
            image: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400',
            rating: 4.3,
            distance: '0.3',
            place_id: 'current-place-test'
        };

        let slotMachineInstance = null;

        // Test functions
        function loadTestRestaurant() {
            updateStatus('è¼‰å…¥æ¸¬è©¦é¤å»³...');
            
            // Update current restaurant
            currentRestaurant = {
                ...currentRestaurant,
                id: 'test-' + Date.now(),
                name: 'æ–°æ¸¬è©¦é¤å»³ ' + new Date().toLocaleTimeString(),
                name_zh: 'æ–°æ¸¬è©¦é¤å»³ ' + new Date().toLocaleTimeString(),
                place_id: 'new-place-' + Date.now()
            };
            
            renderSlotMachine();
            updateStatus('âœ… æ¸¬è©¦é¤å»³å·²è¼‰å…¥');
        }

        function triggerPreloadPool() {
            updateStatus('è§¸ç™¼é è¼‰å…¥æ± ç®¡ç†...');
            
            if (slotMachineInstance && slotMachineInstance.managePreloadPool) {
                slotMachineInstance.managePreloadPool(currentRestaurant);
                updateStatus('âœ… é è¼‰å…¥æ± å·²è§¸ç™¼');
            } else {
                updateStatus('âŒ é è¼‰å…¥æ± åŠŸèƒ½ä¸å¯ç”¨');
            }
        }

        function checkPreloadStatus() {
            if (slotMachineInstance) {
                const status = {
                    preloadPoolSize: slotMachineInstance.preloadPoolSize || 0,
                    backgroundRestaurantsCount: slotMachineInstance.backgroundRestaurantsCount || 0,
                    totalSlides: slotMachineInstance.totalSlides || 0,
                    currentSlideIndex: slotMachineInstance.currentSlideIndex || 0
                };
                
                document.getElementById('preload-status').innerHTML = `
                    é è¼‰å…¥æ± å¤§å°: ${status.preloadPoolSize}<br>
                    èƒŒæ™¯é¤å»³æ•¸é‡: ${status.backgroundRestaurantsCount}<br>
                    ç¸½æ»‘å‹•é æ•¸: ${status.totalSlides}<br>
                    ç•¶å‰é é¢ç´¢å¼•: ${status.currentSlideIndex}<br>
                    æ›´æ–°æ™‚é–“: ${new Date().toLocaleTimeString()}
                `;
                
                updateStatus('âœ… é è¼‰å…¥ç‹€æ…‹å·²æ›´æ–°');
            } else {
                updateStatus('âŒ ç„¡æ³•ç²å–é è¼‰å…¥ç‹€æ…‹');
            }
        }

        function simulateBackgroundRefill() {
            updateStatus('æ¨¡æ“¬å¹•å¾Œè£œå……...');
            
            // Simulate low restaurant count to trigger background refill
            window.getAvailableRestaurantsFromCache = function() {
                return Promise.resolve([
                    {
                        id: 'low-count-1',
                        name: 'å‰©é¤˜é¤å»³ 1',
                        name_zh: 'å‰©é¤˜é¤å»³ 1',
                        image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400',
                        rating: 4.1,
                        distance: '1.5',
                        place_id: 'low-place-1'
                    }
                ]);
            };
            
            triggerPreloadPool();
            updateStatus('âœ… å¹•å¾Œè£œå……å·²æ¨¡æ“¬');
        }

        function updateStatus(message) {
            const statusEl = document.getElementById('test-status');
            const timestamp = new Date().toLocaleTimeString();
            statusEl.innerHTML = `[${timestamp}] ${message}<br>` + statusEl.innerHTML;
        }

        function renderSlotMachine() {
            const translations = {
                slotMachineTitle: 'é¤å»³è€è™æ©Ÿ',
                spinning: 'è½‰å‹•ä¸­...',
                searchNext: 'æœå°‹ä¸‹ä¸€å®¶',
                navigate: 'å°èˆª'
            };

            const element = React.createElement(window.SlotMachine, {
                isSpinning: false,
                onSpin: () => console.log('Spin triggered'),
                onAddCandidate: () => console.log('Add candidate'),
                translations: translations,
                finalRestaurant: currentRestaurant,
                candidateList: [],
                language: 'zh',
                onClearList: () => {},
                onRemoveCandidate: () => {},
                onImageClick: () => {},
                userLocation: { lat: 25.033, lng: 121.5654 },
                userAddress: 'æ¸¬è©¦åœ°å€',
                onPreviousRestaurant: () => {},
                onTriggerSlideTransition: (instance) => {
                    slotMachineInstance = instance;
                    console.log('SlotMachine instance ready:', instance);
                },
                restaurantHistory: [],
                selectedMealTime: 'current'
            });

            ReactDOM.render(element, document.getElementById('slot-machine-container'));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('åˆå§‹åŒ–æ¸¬è©¦ç’°å¢ƒ...');
            renderSlotMachine();
            updateStatus('âœ… æ¸¬è©¦ç’°å¢ƒå·²æº–å‚™å°±ç·’');
        });
    </script>

    <!-- Load SlotMachine component -->
    <script src="../components/SlotMachine.js"></script>
</body>
</html>
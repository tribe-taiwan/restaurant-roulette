<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滑動對齊布局測試</title>
    
    <!-- 載入樣式 -->
    <link rel="stylesheet" href="../components/shared/garmin-design-system.css">
    <link rel="stylesheet" href="../components/shared/shared-components.css">
    <link rel="stylesheet" href="../components/shared/responsive-performance.css">
    <link rel="stylesheet" href="../components/shared/snap-scroll-layout.css">
    <link rel="stylesheet" href="../components/LocationManager/LocationManager.css">
    <link rel="stylesheet" href="../components/SearchSettings/SearchSettings.css">
    
    <style>
        /* 測試專用樣式 */
        .test-section-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section-title {
            font-size: 32px;
            font-weight: bold;
            color: var(--theme-accent);
            margin-bottom: 10px;
        }
        
        .test-section-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            opacity: 0.8;
        }
        
        .demo-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--unified-border-radius);
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .demo-card {
            background: var(--surface-color);
            border-radius: var(--unified-border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--theme-shadow-md);
            transition: all var(--transition-normal);
        }
        
        .demo-card:hover {
            transform: var(--hover-scale);
            box-shadow: var(--theme-shadow-lg);
        }
        
        .demo-button {
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-accent));
            color: white;
            border: none;
            border-radius: var(--unified-border-radius);
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin: 5px;
        }
        
        .demo-button:hover {
            transform: var(--hover-transform);
            box-shadow: var(--theme-shadow-lg);
        }
        
        .status-display {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .navigation-help {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            text-align: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        /* 確保每個區塊都有不同的背景 */
        .snap-section--hero {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .snap-section--location {
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
        }
        
        .snap-section--settings {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }
        
        .snap-section--results {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
        }
        
        .snap-section--demo {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
        }
    </style>
</head>
<body>
    <!-- 狀態顯示 -->
    <div class="status-display" id="statusDisplay">
        <div>當前區塊: <span id="currentSection">1</span> / <span id="totalSections">5</span></div>
        <div>區塊標題: <span id="sectionTitle">首頁</span></div>
        <div>滑動狀態: <span id="scrollStatus">靜止</span></div>
    </div>
    
    <!-- 導航說明 */
    <div class="navigation-help">
        滑動、方向鍵、滾輪或點擊右側圓點來導航
    </div>

    <!-- 滑動容器 -->
    <div class="snap-scroll-container">
        
        <!-- 區塊1: 首頁 -->
        <div class="snap-section snap-section--hero" data-section-title="首頁">
            <div class="snap-section-content">
                <div class="test-section-header">
                    <div class="test-section-title">🍽️ 甲崩喔</div>
                    <div class="test-section-subtitle">台南美食輪盤 - 滑動對齊測試</div>
                </div>
                
                <div class="demo-content">
                    <h3>歡迎使用滑動對齊布局系統</h3>
                    <p>這個系統確保每個功能區塊在手機螢幕內完整顯示，避免出現半截內容的情況。</p>
                    
                    <div class="demo-grid">
                        <div class="demo-card">
                            <h4>📱 手機優先</h4>
                            <p>專為手機設計的滑動體驗</p>
                        </div>
                        <div class="demo-card">
                            <h4>🎯 精準對齊</h4>
                            <p>每個區塊都會精準對齊到視窗</p>
                        </div>
                        <div class="demo-card">
                            <h4>⚡ 流暢動畫</h4>
                            <p>60fps的流暢滑動動畫</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="demo-button" onclick="scrollToNext()">開始體驗 →</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 區塊2: 位置設定 -->
        <div class="snap-section snap-section--location" data-section-title="位置設定">
            <div class="snap-section-content">
                <div class="test-section-header">
                    <div class="test-section-title">📍 位置設定</div>
                    <div class="test-section-subtitle">LocationManager 組件測試</div>
                </div>
                
                <!-- LocationManager 組件 -->
                <div class="location-manager-mobile">
                    <div class="location-manager-container">
                        <div class="location-manager-card">
                            <div class="location-section">
                                <div class="current-location-display">
                                    <div class="current-location-content">
                                        <div class="current-location-icon">📍</div>
                                        <div class="current-location-text">
                                            <div class="current-location-label">當前位置</div>
                                            <div class="current-location-address">台南市中西區中山路123號</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="location-section">
                                <div class="quick-location-buttons">
                                    <div class="quick-buttons-container">
                                        <button class="quick-location-btn bg-gray-500">
                                            <div class="quick-btn-icon">🏠</div>
                                            <div class="quick-btn-text">住家</div>
                                        </button>
                                        <button class="quick-location-btn bg-orange-500">
                                            <div class="quick-btn-icon">💼</div>
                                            <div class="quick-btn-text">公司</div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="location-section">
                                <div class="address-input-container">
                                    <div class="address-input-wrapper">
                                        <div class="address-input-icon">🔍</div>
                                        <input type="text" class="address-input-field" placeholder="輸入地址或地標">
                                    </div>
                                </div>
                            </div>
                            <div class="location-section location-section-last">
                                <div class="location-actions">
                                    <div class="location-actions-container">
                                        <button class="location-action-btn btn-primary">
                                            <div class="location-btn-content">
                                                <div class="location-btn-icon">📍</div>
                                                <div class="location-btn-text">自動定位</div>
                                            </div>
                                        </button>
                                        <button class="location-action-btn btn-success">
                                            <div class="location-btn-content">
                                                <div class="location-btn-icon">⏰</div>
                                                <div class="location-btn-text">手動定位</div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="demo-content">
                    <p>這個區塊展示了LocationManager組件，注意它的寬度現在與其他區塊保持一致。</p>
                </div>
            </div>
        </div>
        
        <!-- 區塊3: 搜尋設定 -->
        <div class="snap-section snap-section--settings" data-section-title="搜尋設定">
            <div class="snap-section-content">
                <div class="test-section-header">
                    <div class="test-section-title">⚙️ 搜尋設定</div>
                    <div class="test-section-subtitle">SearchSettings 組件測試</div>
                </div>
                
                <!-- SearchSettings 組件 -->
                <div class="garmin-distance-control">
                    <div class="distance-display">
                        <span class="distance-value">1.5</span>
                        <span class="distance-label">公里範圍</span>
                    </div>
                    
                    <div class="unit-switcher">
                        <button class="unit-button active">公里</button>
                        <button class="unit-button">英里</button>
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-track">
                            <div class="slider-progress" style="--progress: 30%;"></div>
                            <input type="range" class="garmin-slider" min="1" max="10" value="3">
                        </div>
                    </div>
                    
                    <div class="meal-time-selector-grid">
                        <div class="meal-time-row">
                            <button class="meal-time-button">
                                <div class="meal-time-button-content">
                                    <div class="meal-time-icon">🌅</div>
                                    <div class="meal-time-label">早餐</div>
                                    <div class="meal-time-time">06:00-10:00</div>
                                </div>
                            </button>
                            <button class="meal-time-button selected">
                                <div class="meal-time-button-content">
                                    <div class="meal-time-icon">☀️</div>
                                    <div class="meal-time-label">午餐</div>
                                    <div class="meal-time-time">11:00-14:00</div>
                                </div>
                            </button>
                            <button class="meal-time-button">
                                <div class="meal-time-button-content">
                                    <div class="meal-time-icon">🌙</div>
                                    <div class="meal-time-label">晚餐</div>
                                    <div class="meal-time-time">17:00-21:00</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="demo-content">
                    <p>搜尋設定區塊，包含距離控制和用餐時段選擇器。</p>
                </div>
            </div>
        </div>
        
        <!-- 區塊4: 搜尋結果 -->
        <div class="snap-section snap-section--results" data-section-title="搜尋結果">
            <div class="snap-section-content">
                <div class="test-section-header">
                    <div class="test-section-title">🎰 搜尋結果</div>
                    <div class="test-section-subtitle">老虎機風格結果展示</div>
                </div>
                
                <div class="demo-content">
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">🍜</div>
                        <h3>阿明牛肉麵</h3>
                        <p>距離: 0.8公里 | 評分: ⭐⭐⭐⭐⭐</p>
                        <p>台南市中西區民族路二段123號</p>
                        
                        <div style="margin-top: 30px;">
                            <button class="demo-button">查看詳情</button>
                            <button class="demo-button">重新搜尋</button>
                        </div>
                    </div>
                </div>
                
                <div class="demo-grid">
                    <div class="demo-card">
                        <h4>🎯 精準推薦</h4>
                        <p>基於位置和偏好的智能推薦</p>
                    </div>
                    <div class="demo-card">
                        <h4>📊 詳細資訊</h4>
                        <p>距離、評分、營業時間等</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 區塊5: 測試功能 -->
        <div class="snap-section snap-section--demo" data-section-title="測試功能">
            <div class="snap-section-content">
                <div class="test-section-header">
                    <div class="test-section-title">🧪 測試功能</div>
                    <div class="test-section-subtitle">滑動對齊系統測試</div>
                </div>
                
                <div class="demo-content">
                    <h3>滑動對齊功能測試</h3>
                    
                    <div class="demo-grid">
                        <button class="demo-button" onclick="testScrollToSection(0)">跳到首頁</button>
                        <button class="demo-button" onclick="testScrollToSection(1)">跳到位置設定</button>
                        <button class="demo-button" onclick="testScrollToSection(2)">跳到搜尋設定</button>
                        <button class="demo-button" onclick="testScrollToSection(3)">跳到搜尋結果</button>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4>測試結果:</h4>
                        <div id="testResults" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                            等待測試...
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="demo-button" onclick="runFullTest()">運行完整測試</button>
                        <button class="demo-button" onclick="runValidation()">運行驗證</button>
                        <button class="demo-button" onclick="showDeviceInfo()">顯示設備信息</button>
                        <button class="demo-button" onclick="clearTestResults()">清除結果</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 載入腳本 -->
    <script src="../utils/performanceMonitor.js"></script>
    <script src="../utils/responsiveLayoutManager.js"></script>
    <script src="../utils/snapScrollManager.js"></script>
    <script src="validate-snap-scroll-layout.js"></script>
    
    <script>
        // 測試變數
        let testResults = [];
        
        // 初始化測試
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🧪 開始滑動對齊布局測試');
            
            // 等待滑動管理器初始化
            setTimeout(() => {
                initializeTest();
            }, 1000);
        });
        
        // 初始化測試
        function initializeTest() {
            // 監聽區塊變化
            window.SnapScrollManager.onSectionChange((data) => {
                updateStatusDisplay(data);
                logTestResult(`區塊變化: ${data.from + 1} → ${data.to + 1}`);
            });
            
            // 監聽滾動開始
            window.SnapScrollManager.onScrollStart((data) => {
                document.getElementById('scrollStatus').textContent = '滑動中';
                logTestResult(`開始滑動 (區塊 ${data.section + 1})`);
            });
            
            // 監聽滾動結束
            window.SnapScrollManager.onScrollEnd((data) => {
                document.getElementById('scrollStatus').textContent = '靜止';
                logTestResult(`滑動結束 (區塊 ${data.section + 1})`);
            });
            
            // 初始狀態更新
            updateStatusDisplay({
                to: 0,
                section: document.querySelector('.snap-section')
            });
            
            console.log('✅ 測試初始化完成');
        }
        
        // 更新狀態顯示
        function updateStatusDisplay(data) {
            const state = window.SnapScrollManager.getCurrentState();
            
            document.getElementById('currentSection').textContent = state.currentSection + 1;
            document.getElementById('totalSections').textContent = state.totalSections;
            document.getElementById('sectionTitle').textContent = state.sectionTitle || '未知';
        }
        
        // 記錄測試結果
        function logTestResult(message) {
            const timestamp = new Date().toLocaleTimeString();
            const result = `[${timestamp}] ${message}`;
            
            testResults.push(result);
            
            const resultsElement = document.getElementById('testResults');
            if (resultsElement) {
                resultsElement.textContent = testResults.slice(-20).join('\n');
                resultsElement.scrollTop = resultsElement.scrollHeight;
            }
            
            console.log('📝', result);
        }
        
        // 滾動到下一個區塊
        function scrollToNext() {
            window.SnapScrollManager.nextSection();
        }
        
        // 測試滾動到指定區塊
        function testScrollToSection(index) {
            logTestResult(`測試: 滾動到區塊 ${index + 1}`);
            window.SnapScrollManager.scrollToSection(index);
        }
        
        // 運行完整測試
        function runFullTest() {
            logTestResult('=== 開始完整測試 ===');
            
            const tests = [
                () => testScrollToSection(0),
                () => testScrollToSection(1),
                () => testScrollToSection(2),
                () => testScrollToSection(3),
                () => testScrollToSection(4),
                () => testScrollToSection(0)
            ];
            
            let testIndex = 0;
            
            function runNextTest() {
                if (testIndex < tests.length) {
                    tests[testIndex]();
                    testIndex++;
                    setTimeout(runNextTest, 1500);
                } else {
                    logTestResult('=== 完整測試結束 ===');
                    
                    // 生成測試報告
                    setTimeout(() => {
                        generateTestReport();
                    }, 1000);
                }
            }
            
            runNextTest();
        }
        
        // 清除測試結果
        function clearTestResults() {
            testResults = [];
            document.getElementById('testResults').textContent = '等待測試...';
        }
        
        // 運行驗證
        function runValidation() {
            logTestResult('=== 開始滑動對齊驗證 ===');
            const validator = new SnapScrollLayoutValidator();
            validator.validate();
        }
        
        // 顯示設備信息
        function showDeviceInfo() {
            const state = window.SnapScrollManager.getCurrentState();
            const deviceInfo = state.deviceInfo;
            
            logTestResult('=== 設備檢測信息 ===');
            logTestResult(`設備類型: ${deviceInfo.type}`);
            logTestResult(`螢幕尺寸: ${deviceInfo.width}×${deviceInfo.height}`);
            logTestResult(`觸控支援: ${deviceInfo.hasTouch ? '是' : '否'}`);
            logTestResult(`滑鼠懸停: ${deviceInfo.hasHover ? '是' : '否'}`);
            logTestResult(`僅觸控: ${deviceInfo.hasTouchOnly ? '是' : '否'}`);
            logTestResult(`像素密度: ${deviceInfo.devicePixelRatio}`);
            logTestResult(`方向: ${deviceInfo.isPortrait ? '豎屏' : '橫屏'}`);
            logTestResult(`User Agent - 手機: ${deviceInfo.userAgent.isMobile ? '是' : '否'}`);
            logTestResult(`User Agent - 平板: ${deviceInfo.userAgent.isTablet ? '是' : '否'}`);
            logTestResult(`User Agent - iOS: ${deviceInfo.userAgent.isIOS ? '是' : '否'}`);
            logTestResult(`User Agent - Android: ${deviceInfo.userAgent.isAndroid ? '是' : '否'}`);
            logTestResult(`滑動對齊啟用: ${state.snapEnabled ? '是' : '否'}`);
            logTestResult('=== 設備檢測完成 ===');
        }
        
        // 生成測試報告
        function generateTestReport() {
            const state = window.SnapScrollManager.getCurrentState();
            const performanceReport = window.PerformanceMonitor?.getPerformanceReport();
            
            const report = {
                timestamp: new Date().toISOString(),
                snapScrollState: state,
                performanceMetrics: performanceReport,
                testResults: testResults.slice(-10),
                browserInfo: {
                    userAgent: navigator.userAgent,
                    viewport: {
                        width: window.innerWidth,
                        height: window.innerHeight
                    },
                    devicePixelRatio: window.devicePixelRatio
                }
            };
            
            console.log('📋 滑動對齊測試報告:', report);
            logTestResult('測試報告已生成 (查看控制台)');
            
            return report;
        }
        
        // 鍵盤快捷鍵
        document.addEventListener('keydown', function(e) {
            switch (e.key) {
                case '1':
                    testScrollToSection(0);
                    break;
                case '2':
                    testScrollToSection(1);
                    break;
                case '3':
                    testScrollToSection(2);
                    break;
                case '4':
                    testScrollToSection(3);
                    break;
                case '5':
                    testScrollToSection(4);
                    break;
                case 't':
                case 'T':
                    runFullTest();
                    break;
                case 'c':
                case 'C':
                    clearTestResults();
                    break;
            }
        });
        
        // 觸控手勢測試
        let touchStartY = 0;
        let touchEndY = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
            logTestResult(`觸控開始: Y=${Math.round(touchStartY)}`);
        });
        
        document.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].clientY;
            const diff = touchStartY - touchEndY;
            
            logTestResult(`觸控結束: Y=${Math.round(touchEndY)}, 差值=${Math.round(diff)}`);
            
            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    logTestResult('檢測到向上滑動手勢');
                } else {
                    logTestResult('檢測到向下滑動手勢');
                }
            }
        });
        
        // 滾輪事件測試
        document.addEventListener('wheel', function(e) {
            logTestResult(`滾輪事件: deltaY=${Math.round(e.deltaY)}`);
        });
        
        // 視窗大小變化測試
        window.addEventListener('resize', function() {
            logTestResult(`視窗大小變化: ${window.innerWidth}x${window.innerHeight}`);
        });
        
        // 方向變化測試
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                logTestResult(`方向變化: ${window.innerWidth}x${window.innerHeight}`);
            }, 100);
        });
    </script>
</body>
</html>
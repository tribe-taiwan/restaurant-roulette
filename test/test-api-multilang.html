<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places API 多語言測試</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .restaurant-card {
            background: #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff6b35;
        }
        .restaurant-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .restaurant-details {
            color: #ccc;
            font-size: 14px;
        }
        .language-header {
            color: #ff6b35;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #e55a2e;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .status.success {
            background: #1a4f3a;
            border: 1px solid #28a745;
        }
        .status.error {
            background: #4a1a1a;
            border: 1px solid #dc3545;
        }
        .comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌐 Google Places API 多語言支援測試</h1>
        <p>測試相同餐廳在不同語言參數下是否返回不同的名稱</p>
        
        <div class="test-section">
            <h2>測試控制</h2>
            <button onclick="testMultiLanguageSupport()">開始多語言測試</button>
            <button onclick="clearResults()">清除結果</button>
            <div id="status"></div>
        </div>

        <div id="results" class="comparison"></div>
    </div>

    <script>
        let placesService;
        let testResults = {};

        // Google Maps API 載入完成後的回調
        window.initMap = function() {
            console.log('✅ Google Maps API 已載入');
            
            // 建立隱藏地圖和 PlacesService
            const mapDiv = document.createElement('div');
            mapDiv.style.display = 'none';
            document.body.appendChild(mapDiv);
            
            const map = new google.maps.Map(mapDiv, {
                center: { lat: 25.033, lng: 121.5654 },
                zoom: 15
            });
            
            placesService = new google.maps.places.PlacesService(map);
            
            showStatus('Google Maps API 初始化完成，可以開始測試', 'success');
        };

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testMultiLanguageSupport() {
            if (!placesService) {
                showStatus('Google Maps API 尚未初始化', 'error');
                return;
            }

            showStatus('開始多語言測試...', 'success');
            
            // 測試地點：台北101附近
            const testLocation = { lat: 25.033, lng: 121.5654 };
            
            // 測試語言清單
            const languages = [
                { code: 'zh-TW', name: '繁體中文', flag: '🇹🇼' },
                { code: 'en', name: 'English', flag: '🇺🇸' },
                { code: 'ja', name: '日本語', flag: '🇯🇵' },
                { code: 'ko', name: '한국어', flag: '🇰🇷' }
            ];

            testResults = {};

            // 依次測試每種語言
            for (const lang of languages) {
                try {
                    showStatus(`測試 ${lang.flag} ${lang.name} 中...`, 'success');
                    const restaurants = await searchWithLanguage(testLocation, lang.code);
                    testResults[lang.code] = {
                        language: lang,
                        restaurants: restaurants
                    };
                    console.log(`${lang.name} 結果:`, restaurants);
                } catch (error) {
                    console.error(`${lang.name} 測試失敗:`, error);
                    testResults[lang.code] = {
                        language: lang,
                        error: error.message
                    };
                }
            }

            // 顯示結果比較
            displayComparison();
            showStatus('多語言測試完成！請查看結果比較', 'success');
        }

        function searchWithLanguage(location, languageCode) {
            return new Promise((resolve, reject) => {
                const request = {
                    location: new google.maps.LatLng(location.lat, location.lng),
                    radius: 1000,
                    type: 'restaurant',
                    language: languageCode  // 關鍵：設定語言參數
                };

                placesService.nearbySearch(request, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        resolve(results.slice(0, 5)); // 只取前5家進行比較
                    } else {
                        reject(new Error(`搜索失敗: ${status}`));
                    }
                });
            });
        }

        function displayComparison() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            // 為每種語言創建一個區塊
            Object.values(testResults).forEach(result => {
                const langDiv = document.createElement('div');
                langDiv.className = 'test-section';
                
                const header = document.createElement('div');
                header.className = 'language-header';
                header.innerHTML = `${result.language.flag} ${result.language.name}`;
                langDiv.appendChild(header);

                if (result.error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'status error';
                    errorDiv.textContent = result.error;
                    langDiv.appendChild(errorDiv);
                } else {
                    // 顯示餐廳列表
                    result.restaurants.forEach((restaurant, index) => {
                        const restaurantDiv = document.createElement('div');
                        restaurantDiv.className = 'restaurant-card';
                        restaurantDiv.innerHTML = `
                            <div class="restaurant-name">${restaurant.name}</div>
                            <div class="restaurant-details">
                                評分: ${restaurant.rating || 'N/A'} | 
                                類型: ${restaurant.types ? restaurant.types[0] : 'N/A'} | 
                                ID: ${restaurant.place_id.substring(0, 8)}...
                            </div>
                        `;
                        langDiv.appendChild(restaurantDiv);
                    });
                }

                resultsDiv.appendChild(langDiv);
            });

            // 分析比較結果
            analyzeResults();
        }

        function analyzeResults() {
            const languages = Object.keys(testResults);
            const analysisDiv = document.createElement('div');
            analysisDiv.className = 'test-section';
            analysisDiv.innerHTML = '<div class="language-header">📊 結果分析</div>';

            if (languages.length < 2) {
                analysisDiv.innerHTML += '<div class="status error">需要至少2種語言的結果進行比較</div>';
                document.getElementById('results').appendChild(analysisDiv);
                return;
            }

            // 比較餐廳名稱是否不同
            const firstLang = testResults[languages[0]];
            let hasDifferentNames = false;
            let sameRestaurantDifferentNames = [];

            if (!firstLang.error && firstLang.restaurants) {
                languages.slice(1).forEach(langCode => {
                    const otherLang = testResults[langCode];
                    if (!otherLang.error && otherLang.restaurants) {
                        // 比較相同餐廳的名稱
                        firstLang.restaurants.forEach((restaurant1, index) => {
                            const restaurant2 = otherLang.restaurants[index];
                            if (restaurant1 && restaurant2 && 
                                restaurant1.place_id === restaurant2.place_id &&
                                restaurant1.name !== restaurant2.name) {
                                hasDifferentNames = true;
                                sameRestaurantDifferentNames.push({
                                    placeId: restaurant1.place_id,
                                    lang1: { code: languages[0], name: restaurant1.name },
                                    lang2: { code: langCode, name: restaurant2.name }
                                });
                            }
                        });
                    }
                });
            }

            // 顯示分析結果
            let analysisHTML = '';
            if (hasDifferentNames) {
                analysisHTML += '<div class="status success">✅ <strong>Google Places API 支援多語言餐廳名稱！</strong></div>';
                analysisHTML += '<div><strong>發現的差異：</strong></div>';
                sameRestaurantDifferentNames.forEach(diff => {
                    analysisHTML += `
                        <div class="restaurant-card">
                            <div><strong>${diff.lang1.code}:</strong> ${diff.lang1.name}</div>
                            <div><strong>${diff.lang2.code}:</strong> ${diff.lang2.name}</div>
                            <div style="color: #999; font-size: 12px;">Place ID: ${diff.placeId.substring(0, 12)}...</div>
                        </div>
                    `;
                });
                analysisHTML += '<div class="status success"><strong>結論：</strong> 可以採用方案二 - 顯示中文+用戶選擇語言+距離</div>';
            } else {
                analysisHTML += '<div class="status error">❌ <strong>Google Places API 不支援多語言餐廳名稱</strong></div>';
                analysisHTML += '<div>所有語言返回的餐廳名稱都相同，建議採用方案一 - 顯示中文+英文+距離</div>';
            }

            analysisDiv.innerHTML += analysisHTML;
            document.getElementById('results').appendChild(analysisDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = {};
            showStatus('結果已清除', 'success');
        }
    </script>

    <!-- 載入 Google Maps API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=%%GOOGLE_PLACES_API_KEY%%&libraries=places&callback=initMap">
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places API å¤šèªè¨€æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .restaurant-card {
            background: #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff6b35;
        }
        .restaurant-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .restaurant-details {
            color: #ccc;
            font-size: 14px;
        }
        .language-header {
            color: #ff6b35;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #e55a2e;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .status.success {
            background: #1a4f3a;
            border: 1px solid #28a745;
        }
        .status.error {
            background: #4a1a1a;
            border: 1px solid #dc3545;
        }
        .comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ Google Places API å¤šèªè¨€æ”¯æ´æ¸¬è©¦</h1>
        <p>æ¸¬è©¦ç›¸åŒé¤å»³åœ¨ä¸åŒèªè¨€åƒæ•¸ä¸‹æ˜¯å¦è¿”å›ä¸åŒçš„åç¨±</p>
        
        <div class="test-section">
            <h2>æ¸¬è©¦æ§åˆ¶</h2>
            <button onclick="testMultiLanguageSupport()">é–‹å§‹å¤šèªè¨€æ¸¬è©¦</button>
            <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
            <div id="status"></div>
        </div>

        <div id="results" class="comparison"></div>
    </div>

    <script>
        let placesService;
        let testResults = {};

        // Google Maps API è¼‰å…¥å®Œæˆå¾Œçš„å›èª¿
        window.initMap = function() {
            console.log('âœ… Google Maps API å·²è¼‰å…¥');
            
            // å»ºç«‹éš±è—åœ°åœ–å’Œ PlacesService
            const mapDiv = document.createElement('div');
            mapDiv.style.display = 'none';
            document.body.appendChild(mapDiv);
            
            const map = new google.maps.Map(mapDiv, {
                center: { lat: 25.033, lng: 121.5654 },
                zoom: 15
            });
            
            placesService = new google.maps.places.PlacesService(map);
            
            showStatus('Google Maps API åˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥é–‹å§‹æ¸¬è©¦', 'success');
        };

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testMultiLanguageSupport() {
            if (!placesService) {
                showStatus('Google Maps API å°šæœªåˆå§‹åŒ–', 'error');
                return;
            }

            showStatus('é–‹å§‹å¤šèªè¨€æ¸¬è©¦...', 'success');
            
            // æ¸¬è©¦åœ°é»ï¼šå°åŒ—101é™„è¿‘
            const testLocation = { lat: 25.033, lng: 121.5654 };
            
            // æ¸¬è©¦èªè¨€æ¸…å–®
            const languages = [
                { code: 'zh-TW', name: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼' },
                { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
                { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
                { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' }
            ];

            testResults = {};

            // ä¾æ¬¡æ¸¬è©¦æ¯ç¨®èªè¨€
            for (const lang of languages) {
                try {
                    showStatus(`æ¸¬è©¦ ${lang.flag} ${lang.name} ä¸­...`, 'success');
                    const restaurants = await searchWithLanguage(testLocation, lang.code);
                    testResults[lang.code] = {
                        language: lang,
                        restaurants: restaurants
                    };
                    console.log(`${lang.name} çµæœ:`, restaurants);
                } catch (error) {
                    console.error(`${lang.name} æ¸¬è©¦å¤±æ•—:`, error);
                    testResults[lang.code] = {
                        language: lang,
                        error: error.message
                    };
                }
            }

            // é¡¯ç¤ºçµæœæ¯”è¼ƒ
            displayComparison();
            showStatus('å¤šèªè¨€æ¸¬è©¦å®Œæˆï¼è«‹æŸ¥çœ‹çµæœæ¯”è¼ƒ', 'success');
        }

        function searchWithLanguage(location, languageCode) {
            return new Promise((resolve, reject) => {
                const request = {
                    location: new google.maps.LatLng(location.lat, location.lng),
                    radius: 1000,
                    type: 'restaurant',
                    language: languageCode  // é—œéµï¼šè¨­å®šèªè¨€åƒæ•¸
                };

                placesService.nearbySearch(request, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        resolve(results.slice(0, 5)); // åªå–å‰5å®¶é€²è¡Œæ¯”è¼ƒ
                    } else {
                        reject(new Error(`æœç´¢å¤±æ•—: ${status}`));
                    }
                });
            });
        }

        function displayComparison() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            // ç‚ºæ¯ç¨®èªè¨€å‰µå»ºä¸€å€‹å€å¡Š
            Object.values(testResults).forEach(result => {
                const langDiv = document.createElement('div');
                langDiv.className = 'test-section';
                
                const header = document.createElement('div');
                header.className = 'language-header';
                header.innerHTML = `${result.language.flag} ${result.language.name}`;
                langDiv.appendChild(header);

                if (result.error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'status error';
                    errorDiv.textContent = result.error;
                    langDiv.appendChild(errorDiv);
                } else {
                    // é¡¯ç¤ºé¤å»³åˆ—è¡¨
                    result.restaurants.forEach((restaurant, index) => {
                        const restaurantDiv = document.createElement('div');
                        restaurantDiv.className = 'restaurant-card';
                        restaurantDiv.innerHTML = `
                            <div class="restaurant-name">${restaurant.name}</div>
                            <div class="restaurant-details">
                                è©•åˆ†: ${restaurant.rating || 'N/A'} | 
                                é¡å‹: ${restaurant.types ? restaurant.types[0] : 'N/A'} | 
                                ID: ${restaurant.place_id.substring(0, 8)}...
                            </div>
                        `;
                        langDiv.appendChild(restaurantDiv);
                    });
                }

                resultsDiv.appendChild(langDiv);
            });

            // åˆ†ææ¯”è¼ƒçµæœ
            analyzeResults();
        }

        function analyzeResults() {
            const languages = Object.keys(testResults);
            const analysisDiv = document.createElement('div');
            analysisDiv.className = 'test-section';
            analysisDiv.innerHTML = '<div class="language-header">ğŸ“Š çµæœåˆ†æ</div>';

            if (languages.length < 2) {
                analysisDiv.innerHTML += '<div class="status error">éœ€è¦è‡³å°‘2ç¨®èªè¨€çš„çµæœé€²è¡Œæ¯”è¼ƒ</div>';
                document.getElementById('results').appendChild(analysisDiv);
                return;
            }

            // æ¯”è¼ƒé¤å»³åç¨±æ˜¯å¦ä¸åŒ
            const firstLang = testResults[languages[0]];
            let hasDifferentNames = false;
            let sameRestaurantDifferentNames = [];

            if (!firstLang.error && firstLang.restaurants) {
                languages.slice(1).forEach(langCode => {
                    const otherLang = testResults[langCode];
                    if (!otherLang.error && otherLang.restaurants) {
                        // æ¯”è¼ƒç›¸åŒé¤å»³çš„åç¨±
                        firstLang.restaurants.forEach((restaurant1, index) => {
                            const restaurant2 = otherLang.restaurants[index];
                            if (restaurant1 && restaurant2 && 
                                restaurant1.place_id === restaurant2.place_id &&
                                restaurant1.name !== restaurant2.name) {
                                hasDifferentNames = true;
                                sameRestaurantDifferentNames.push({
                                    placeId: restaurant1.place_id,
                                    lang1: { code: languages[0], name: restaurant1.name },
                                    lang2: { code: langCode, name: restaurant2.name }
                                });
                            }
                        });
                    }
                });
            }

            // é¡¯ç¤ºåˆ†æçµæœ
            let analysisHTML = '';
            if (hasDifferentNames) {
                analysisHTML += '<div class="status success">âœ… <strong>Google Places API æ”¯æ´å¤šèªè¨€é¤å»³åç¨±ï¼</strong></div>';
                analysisHTML += '<div><strong>ç™¼ç¾çš„å·®ç•°ï¼š</strong></div>';
                sameRestaurantDifferentNames.forEach(diff => {
                    analysisHTML += `
                        <div class="restaurant-card">
                            <div><strong>${diff.lang1.code}:</strong> ${diff.lang1.name}</div>
                            <div><strong>${diff.lang2.code}:</strong> ${diff.lang2.name}</div>
                            <div style="color: #999; font-size: 12px;">Place ID: ${diff.placeId.substring(0, 12)}...</div>
                        </div>
                    `;
                });
                analysisHTML += '<div class="status success"><strong>çµè«–ï¼š</strong> å¯ä»¥æ¡ç”¨æ–¹æ¡ˆäºŒ - é¡¯ç¤ºä¸­æ–‡+ç”¨æˆ¶é¸æ“‡èªè¨€+è·é›¢</div>';
            } else {
                analysisHTML += '<div class="status error">âŒ <strong>Google Places API ä¸æ”¯æ´å¤šèªè¨€é¤å»³åç¨±</strong></div>';
                analysisHTML += '<div>æ‰€æœ‰èªè¨€è¿”å›çš„é¤å»³åç¨±éƒ½ç›¸åŒï¼Œå»ºè­°æ¡ç”¨æ–¹æ¡ˆä¸€ - é¡¯ç¤ºä¸­æ–‡+è‹±æ–‡+è·é›¢</div>';
            }

            analysisDiv.innerHTML += analysisHTML;
            document.getElementById('results').appendChild(analysisDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = {};
            showStatus('çµæœå·²æ¸…é™¤', 'success');
        }
    </script>

    <!-- è¼‰å…¥ Google Maps API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=%%GOOGLE_PLACES_API_KEY%%&libraries=places&callback=initMap">
    </script>
</body>
</html>
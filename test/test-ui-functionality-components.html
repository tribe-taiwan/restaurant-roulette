<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI功能組件測試 - Task 7</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 UI功能組件測試 - 任務7</h1>
        <p>此測試驗證所有UI功能組件是否正常工作</p>
        
        <button class="test-button" onclick="runTests()">開始測試</button>
        <button class="test-button" onclick="openMainApp()">打開主應用</button>
        
        <div id="testResults"></div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function openMainApp() {
            window.open('/', '_blank');
        }

        async function runTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            
            addResult('🚀 開始UI功能組件測試...', 'info');

            try {
                // 測試1: 檢查主應用是否可訪問
                addResult('✅ 1. 檢查主應用訪問性', 'info');
                
                const response = await fetch('/');
                if (response.ok) {
                    addResult('   主應用可正常訪問', 'success');
                } else {
                    addResult('   主應用訪問失敗', 'error');
                    return;
                }

                // 測試2: 檢查SlotMachine組件是否存在
                addResult('✅ 2. 檢查SlotMachine組件', 'info');
                
                const slotMachineResponse = await fetch('/components/SlotMachine.js');
                if (slotMachineResponse.ok) {
                    const slotMachineCode = await slotMachineResponse.text();
                    
                    // 檢查候選清單功能
                    if (slotMachineCode.includes('candidateList') && slotMachineCode.includes('onRemoveCandidate')) {
                        addResult('   ✅ 候選清單功能已實現', 'success');
                    } else {
                        addResult('   ❌ 候選清單功能缺失', 'error');
                    }
                    
                    // 檢查評分顯示
                    if (slotMachineCode.includes('renderStars') && slotMachineCode.includes('rating')) {
                        addResult('   ✅ 餐廳評分顯示已實現', 'success');
                    } else {
                        addResult('   ❌ 餐廳評分顯示缺失', 'error');
                    }
                    
                    // 檢查價位標籤
                    if (slotMachineCode.includes('priceLevel') && slotMachineCode.includes('priceLabels')) {
                        addResult('   ✅ 價位標籤顯示已實現', 'success');
                    } else {
                        addResult('   ❌ 價位標籤顯示缺失', 'error');
                    }
                    
                    // 檢查分享按鈕
                    if (slotMachineCode.includes('shareButtonLogic') && slotMachineCode.includes('handleShareClick')) {
                        addResult('   ✅ 分享按鈕功能已實現', 'success');
                    } else {
                        addResult('   ❌ 分享按鈕功能缺失', 'error');
                    }
                    
                    // 檢查導航按鈕
                    if (slotMachineCode.includes('getDirectionsUrl') && slotMachineCode.includes('navigate')) {
                        addResult('   ✅ 導航按鈕功能已實現', 'success');
                    } else {
                        addResult('   ❌ 導航按鈕功能缺失', 'error');
                    }
                    
                } else {
                    addResult('   ❌ SlotMachine組件文件無法訪問', 'error');
                }

                // 測試3: 檢查按鈕邏輯文件
                addResult('✅ 3. 檢查按鈕邏輯實現', 'info');
                
                const buttonLogicResponse = await fetch('/components/SlotMachineButtonLogic.js');
                if (buttonLogicResponse.ok) {
                    const buttonLogicCode = await buttonLogicResponse.text();
                    
                    // 檢查按鈕圖標和文字函數
                    if (buttonLogicCode.includes('getAddButtonIcon') && buttonLogicCode.includes('getAddButtonText')) {
                        addResult('   ✅ 按鈕圖標和文字函數已實現', 'success');
                    } else {
                        addResult('   ❌ 按鈕圖標和文字函數缺失', 'error');
                    }
                    
                    // 檢查分享按鈕邏輯
                    if (buttonLogicCode.includes('getShareButtonIcon') && buttonLogicCode.includes('getShareButtonText')) {
                        addResult('   ✅ 分享按鈕邏輯已實現', 'success');
                    } else {
                        addResult('   ❌ 分享按鈕邏輯缺失', 'error');
                    }
                    
                    // 檢查按鈕狀態管理
                    if (buttonLogicCode.includes('buttonClickState') && buttonLogicCode.includes('isAddButtonDisabled')) {
                        addResult('   ✅ 按鈕狀態管理已實現', 'success');
                    } else {
                        addResult('   ❌ 按鈕狀態管理缺失', 'error');
                    }
                    
                } else {
                    addResult('   ❌ 按鈕邏輯文件無法訪問', 'error');
                }

                // 測試4: 檢查觸控處理
                addResult('✅ 4. 檢查觸控操作支持', 'info');
                
                const touchHandlerResponse = await fetch('/components/SlotMachineTouchHandler.js');
                if (touchHandlerResponse.ok) {
                    addResult('   ✅ 觸控處理文件存在', 'success');
                } else {
                    addResult('   ⚠️ 觸控處理文件可能缺失（但可能在其他文件中實現）', 'info');
                }

                addResult('🎉 UI功能組件測試完成！', 'success');
                addResult('📝 建議：請在主應用中手動測試所有功能以確保完整性', 'info');
                addResult('🔗 點擊"打開主應用"按鈕進行手動測試', 'info');

            } catch (error) {
                addResult(`❌ 測試過程中發生錯誤: ${error.message}`, 'error');
            }
        }

        // 頁面載入時自動運行測試
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>
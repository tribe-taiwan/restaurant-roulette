<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è€è™æ©Ÿè½‰å‹•å¼•æ“åˆ‡æ›æ¸¬è©¦</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* åŸºç¤æ¨£å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      margin: 20px 0;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .control-panel {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }

    .btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn.active {
      background: rgba(76, 175, 80, 0.8);
      border-color: rgba(76, 175, 80, 1);
    }

    .slot-machine {
      width: 300px;
      height: 200px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      margin: 0 auto 20px;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* åŸç‰ˆè€è™æ©Ÿå‹•ç•« - æ°´å¹³æ»‘å‹• */
    .original-engine .slot-content {
      display: flex;
      align-items: center;
      height: 100%;
    }

    .original-engine .slot-item {
      min-width: 300px;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: bold;
      background-size: cover;
      background-position: center;
    }

    /* ç°¡å–®è½‰åœˆå‹•ç•« */
    .simple-engine .slot-content {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    .simple-spinner {
      width: 80px;
      height: 80px;
      border: 8px solid rgba(255, 255, 255, 0.3);
      border-top: 8px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* åŸç‰ˆå‹•ç•«é—œéµå¹€ */
    @keyframes scrollFast {
      0% { transform: translateX(0); }
      100% { transform: translateX(-1500px); }
    }

    @keyframes scrollSlow {
      0% { transform: translateX(0); }
      70% { transform: translateX(-1000px); }
      100% { transform: translateX(-1200px); }
    }

    .animate-fast {
      animation: scrollFast 0.5s linear infinite;
    }

    .animate-slow {
      animation: scrollSlow 2s ease-out forwards;
    }

    .status {
      text-align: center;
      margin: 10px 0;
      font-size: 18px;
      font-weight: 500;
    }

    .info {
      background: rgba(33, 150, 243, 0.2);
      border-left: 4px solid #2196F3;
      padding: 16px;
      margin: 16px 0;
      border-radius: 4px;
    }

    .warning {
      background: rgba(255, 193, 7, 0.2);
      border-left: 4px solid #FFC107;
      padding: 16px;
      margin: 16px 0;
      border-radius: 4px;
    }

    pre {
      background: rgba(0, 0, 0, 0.5);
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 12px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // æ¨¡æ“¬é¤å»³æ•¸æ“š
    const mockRestaurants = [
      { id: 1, name: 'é¼æ³°è±', image: 'ğŸ¥Ÿ', emoji: 'ğŸ¥Ÿ' },
      { id: 2, name: 'éº¥ç•¶å‹', image: 'ğŸŸ', emoji: 'ğŸŸ' },
      { id: 3, name: 'æ˜Ÿå·´å…‹', image: 'â˜•', emoji: 'â˜•' },
      { id: 4, name: 'è‚¯å¾·åŸº', image: 'ğŸ—', emoji: 'ğŸ—' },
      { id: 5, name: 'å¿…å‹å®¢', image: 'ğŸ•', emoji: 'ğŸ•' },
    ];

    // è€è™æ©Ÿå¼•æ“æŠ½è±¡é¡
    class SlotMachineEngine {
      constructor(containerRef, onComplete) {
        this.containerRef = containerRef;
        this.onComplete = onComplete;
        this.isSpinning = false;
      }

      start(finalResult) {
        if (this.isSpinning) return;
        this.isSpinning = true;
        this.spin(finalResult);
      }

      stop() {
        this.isSpinning = false;
        this.cleanup();
      }

      // å­é¡éœ€è¦å¯¦ç¾çš„æ–¹æ³•
      spin(finalResult) {
        throw new Error('å­é¡å¿…é ˆå¯¦ç¾ spin æ–¹æ³•');
      }

      cleanup() {
        // æ¸…ç†å·¥ä½œï¼Œå­é¡å¯ä»¥é‡å¯«
      }
    }

    // åŸç‰ˆè€è™æ©Ÿå¼•æ“ - æ°´å¹³æ»¾å‹•
    class OriginalSlotEngine extends SlotMachineEngine {
      spin(finalResult) {
        const container = this.containerRef.current;
        if (!container) return;

        container.className = 'slot-machine original-engine';
        
        // å‰µå»ºæ»¾å‹•å…§å®¹
        const slotContent = document.createElement('div');
        slotContent.className = 'slot-content';

        // ç”Ÿæˆéš¨æ©Ÿæ»¾å‹•åºåˆ— + æœ€çµ‚çµæœ
        const sequence = [];
        
        // æ·»åŠ éš¨æ©Ÿé …ç›®
        for (let i = 0; i < 8; i++) {
          const randomRestaurant = mockRestaurants[Math.floor(Math.random() * mockRestaurants.length)];
          sequence.push(randomRestaurant);
        }
        
        // æ·»åŠ æœ€çµ‚çµæœ
        sequence.push(finalResult);

        // å‰µå»ºæ»¾å‹•å…ƒç´ 
        sequence.forEach((item, index) => {
          const slotItem = document.createElement('div');
          slotItem.className = 'slot-item';
          slotItem.textContent = item.emoji;
          slotContent.appendChild(slotItem);
        });

        container.innerHTML = '';
        container.appendChild(slotContent);

        // é–‹å§‹å¿«é€Ÿå‹•ç•«
        slotContent.classList.add('animate-fast');

        // 1ç§’å¾Œåˆ‡æ›åˆ°æ…¢é€Ÿå‹•ç•«
        setTimeout(() => {
          slotContent.classList.remove('animate-fast');
          slotContent.classList.add('animate-slow');
        }, 1000);

        // 3ç§’å¾Œå®Œæˆå‹•ç•«
        setTimeout(() => {
          this.isSpinning = false;
          this.onComplete && this.onComplete(finalResult);
        }, 3000);
      }

      cleanup() {
        const container = this.containerRef.current;
        if (container) {
          const slotContent = container.querySelector('.slot-content');
          if (slotContent) {
            slotContent.classList.remove('animate-fast', 'animate-slow');
          }
        }
      }
    }

    // ç°¡å–®è½‰åœˆå¼•æ“
    class SimpleSpinEngine extends SlotMachineEngine {
      spin(finalResult) {
        const container = this.containerRef.current;
        if (!container) return;

        container.className = 'slot-machine simple-engine';
        
        // å‰µå»ºè½‰åœˆå…§å®¹
        const slotContent = document.createElement('div');
        slotContent.className = 'slot-content';

        const spinner = document.createElement('div');
        spinner.className = 'simple-spinner';

        slotContent.appendChild(spinner);
        container.innerHTML = '';
        container.appendChild(slotContent);

        // 2ç§’å¾Œé¡¯ç¤ºçµæœ
        setTimeout(() => {
          container.innerHTML = `
            <div class="slot-content">
              <div style="font-size: 72px; animation: fadeIn 0.5s ease-out;">${finalResult.emoji}</div>
            </div>
          `;
          
          // æ·»åŠ æ·¡å…¥å‹•ç•«
          const style = document.createElement('style');
          style.textContent = `
            @keyframes fadeIn {
              0% { opacity: 0; transform: scale(0.8); }
              100% { opacity: 1; transform: scale(1); }
            }
          `;
          document.head.appendChild(style);

          this.isSpinning = false;
          this.onComplete && this.onComplete(finalResult);
        }, 2000);
      }
    }

    // ä¸»æ¸¬è©¦çµ„ä»¶
    function SlotMachineTest() {
      const [currentEngine, setCurrentEngine] = React.useState('original');
      const [isSpinning, setIsSpinning] = React.useState(false);
      const [lastResult, setLastResult] = React.useState(null);
      const [engineInstance, setEngineInstance] = React.useState(null);
      const slotRef = React.useRef(null);

      // å‰µå»ºå¼•æ“å¯¦ä¾‹
      React.useEffect(() => {
        const onComplete = (result) => {
          setIsSpinning(false);
          setLastResult(result);
          console.log('è½‰å‹•å®Œæˆ:', result);
        };

        let engine;
        if (currentEngine === 'original') {
          engine = new OriginalSlotEngine(slotRef, onComplete);
        } else {
          engine = new SimpleSpinEngine(slotRef, onComplete);
        }

        setEngineInstance(engine);

        return () => {
          if (engine) {
            engine.stop();
          }
        };
      }, [currentEngine]);

      // é–‹å§‹è½‰å‹•
      const handleSpin = () => {
        if (!engineInstance || isSpinning) return;

        const randomResult = mockRestaurants[Math.floor(Math.random() * mockRestaurants.length)];
        setIsSpinning(true);
        setLastResult(null);
        
        console.log('é–‹å§‹è½‰å‹•ï¼Œç›®æ¨™:', randomResult);
        engineInstance.start(randomResult);
      };

      // åˆ‡æ›å¼•æ“
      const switchEngine = (engineType) => {
        if (isSpinning) {
          alert('è½‰å‹•ä¸­ç„¡æ³•åˆ‡æ›å¼•æ“ï¼');
          return;
        }
        setCurrentEngine(engineType);
        setLastResult(null);
        console.log('åˆ‡æ›å¼•æ“:', engineType);
      };

      return (
        <div className="container">
          <h1 style={{ textAlign: 'center', marginBottom: '20px' }}>
            ğŸ° è€è™æ©Ÿè½‰å‹•å¼•æ“åˆ‡æ›æ¸¬è©¦
          </h1>

          <div className="card">
            <div className="info">
              <strong>æ¸¬è©¦ç›®çš„ï¼š</strong> æ¸¬è©¦å¤–éƒ¨è½‰å‹•å¼•æ“çš„åˆ‡æ›åŠŸèƒ½ï¼Œé©—è­‰ä¸åŒå‹•ç•«æ•ˆæœçš„å¯¦ç¾
            </div>

            <div className="control-panel">
              <button
                className={`btn ${currentEngine === 'original' ? 'active' : ''}`}
                onClick={() => switchEngine('original')}
                disabled={isSpinning}
              >
                åŸç‰ˆå¼•æ“ (æ°´å¹³æ»¾å‹•)
              </button>
              <button
                className={`btn ${currentEngine === 'simple' ? 'active' : ''}`}
                onClick={() => switchEngine('simple')}
                disabled={isSpinning}
              >
                ç°¡å–®å¼•æ“ (è½‰åœˆåœˆ)
              </button>
              <button
                className="btn"
                onClick={handleSpin}
                disabled={isSpinning}
                style={{ 
                  background: isSpinning ? 'rgba(255, 255, 255, 0.1)' : 'rgba(76, 175, 80, 0.8)',
                  borderColor: isSpinning ? 'rgba(255, 255, 255, 0.2)' : 'rgba(76, 175, 80, 1)'
                }}
              >
                {isSpinning ? 'è½‰å‹•ä¸­...' : 'ğŸ² é–‹å§‹è½‰å‹•'}
              </button>
            </div>

            <div className="slot-machine" ref={slotRef}>
              <div className="slot-content">
                <div style={{ fontSize: '48px', opacity: '0.5' }}>
                  {lastResult ? lastResult.emoji : 'ğŸ°'}
                </div>
              </div>
            </div>

            <div className="status">
              ç•¶å‰å¼•æ“: <strong>{currentEngine === 'original' ? 'åŸç‰ˆæ°´å¹³æ»¾å‹•' : 'ç°¡å–®è½‰åœˆ'}</strong>
              {isSpinning && ' | è½‰å‹•ä¸­...'}
              {lastResult && ` | çµæœ: ${lastResult.name} ${lastResult.emoji}`}
            </div>
          </div>

          <div className="card">
            <h3>ğŸ”§ å¼•æ“æ¶æ§‹èªªæ˜</h3>
            <div className="warning">
              <strong>è¨­è¨ˆç†å¿µï¼š</strong> ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯¦ç¾å¯åˆ‡æ›çš„è½‰å‹•å¼•æ“ï¼Œä¾¿æ–¼ç”Ÿç”¢ç’°å¢ƒä¸­å‹•æ…‹åˆ‡æ›å‹•ç•«æ•ˆæœ
            </div>

            <h4>æ ¸å¿ƒæ¶æ§‹:</h4>
            <pre>{`
// æŠ½è±¡å¼•æ“åŸºé¡
class SlotMachineEngine {
  constructor(containerRef, onComplete) { ... }
  start(finalResult) { ... }    // é–‹å§‹è½‰å‹•
  stop() { ... }                // åœæ­¢è½‰å‹•
  spin(finalResult) { ... }     // å­é¡å¯¦ç¾å…·é«”å‹•ç•«
  cleanup() { ... }             // æ¸…ç†å·¥ä½œ
}

// åŸç‰ˆå¼•æ“ - æ°´å¹³æ»¾å‹•æ•ˆæœ
class OriginalSlotEngine extends SlotMachineEngine {
  spin(finalResult) {
    // 1. ç”Ÿæˆéš¨æ©Ÿåºåˆ— + æœ€çµ‚çµæœ
    // 2. å‰µå»ºæ°´å¹³æ»¾å‹•å‹•ç•«
    // 3. å¿«é€Ÿå‹•ç•« â†’ æ…¢é€Ÿå‹•ç•« â†’ åœæ­¢
  }
}

// ç°¡å–®å¼•æ“ - è½‰åœˆæ•ˆæœ
class SimpleSpinEngine extends SlotMachineEngine {
  spin(finalResult) {
    // 1. é¡¯ç¤ºè½‰åœˆå‹•ç•«
    // 2. å»¶é²å¾Œé¡¯ç¤ºæœ€çµ‚çµæœ
    // 3. æ·¡å…¥æ•ˆæœ
  }
}
            `}</pre>

            <h4>ç”Ÿç”¢ç’°å¢ƒæ•´åˆå»ºè­°:</h4>
            <pre>{`
// åœ¨ SlotMachine.js ä¸­æ•´åˆ
const SlotMachine = ({ engineType = 'original', ...props }) => {
  const [engine, setEngine] = React.useState(null);
  
  React.useEffect(() => {
    const onComplete = (result) => {
      setIsSpinning(false);
      // è™•ç†çµæœ...
    };
    
    let newEngine;
    switch(engineType) {
      case 'simple':
        newEngine = new SimpleSpinEngine(slotRef, onComplete);
        break;
      default:
        newEngine = new OriginalSlotEngine(slotRef, onComplete);
    }
    
    setEngine(newEngine);
    return () => newEngine.stop();
  }, [engineType]);
  
  // åœ¨ handleSpin ä¸­ä½¿ç”¨ engine.start(finalResult)
};
            `}</pre>

            <div className="info">
              <strong>å„ªå‹¢ï¼š</strong>
              <ul style={{ marginLeft: '20px', marginTop: '8px' }}>
                <li>ğŸ”„ ç†±åˆ‡æ›ï¼šé‹è¡Œæ™‚å‹•æ…‹åˆ‡æ›å‹•ç•«å¼•æ“</li>
                <li>ğŸ§© æ¨¡çµ„åŒ–ï¼šæ¯å€‹å¼•æ“ç¨ç«‹å¯¦ç¾ï¼Œæ˜“æ–¼ç¶­è­·</li>
                <li>ğŸ¯ ä¸€è‡´ä»‹é¢ï¼šçµ±ä¸€çš„ start/stop API</li>
                <li>ğŸš€ æ“´å±•æ€§ï¼šè¼•é¬†æ·»åŠ æ–°çš„å‹•ç•«æ•ˆæœ</li>
                <li>ğŸ›ï¸ ç”¨æˆ¶åå¥½ï¼šå¯ä»¥è®“ç”¨æˆ¶é¸æ“‡å–œæ­¡çš„å‹•ç•«</li>
              </ul>
            </div>
          </div>
        </div>
      );
    }

    // æ¸²æŸ“æ‡‰ç”¨
    ReactDOM.render(<SlotMachineTest />, document.getElementById('root'));
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®æ»‘å‹•è½‰å ´æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* æ»‘å‹•è½‰å ´å‹•ç•« */
        @keyframes slideInFromRight {
            0% { transform: translateX(100%); }
            100% { transform: translateX(0); }
        }

        @keyframes slideInFromLeft {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div id="root">
        <div class="text-center">
            <h1 class="text-2xl font-bold mb-4">ç°¡å–®æ»‘å‹•è½‰å ´æ¸¬è©¦</h1>
            <div class="text-lg">è¼‰å…¥ä¸­...</div>
        </div>
    </div>

    <!-- è¼‰å…¥ä¸»é…ç½® -->
    <script src="../utils/locationUtils.js"></script>
    
    <script type="text/babel">
        const { useState, useCallback, useRef, useEffect } = React;

        function SimpleSlideTest() {
            // æ»‘å‹•è½‰å ´ç‹€æ…‹
            const [isSliding, setIsSliding] = useState(false);
            const [currentImage, setCurrentImage] = useState(null);
            const [nextImage, setNextImage] = useState(null);
            const [slideDirection, setSlideDirection] = useState('left');
            
            // æ¸¬è©¦åœ–ç‰‡
            const testImages = [
                'https://picsum.photos/400/300?random=1',
                'https://picsum.photos/400/300?random=2',
                'https://picsum.photos/400/300?random=3',
                'https://picsum.photos/400/300?random=4',
                'https://picsum.photos/400/300?random=5'
            ];
            
            const [currentImageIndex, setCurrentImageIndex] = useState(0);
            const [displayImage, setDisplayImage] = useState(testImages[0]);
            const [finalRestaurant, setFinalRestaurant] = useState({
                name: 'æ¸¬è©¦é¤å»³ 1',
                image: testImages[0]
            });

            // æ»‘å‹•è½‰å ´å‡½æ•¸ï¼ˆè¤‡è£½è‡ª SlotMachine.jsï¼‰
            const triggerSlideTransition = useCallback((newRestaurant, direction = 'left') => {
                console.log('ğŸ”„ æ»‘å‹•è½‰å ´è§¸ç™¼æª¢æŸ¥:', { isSliding, newRestaurant: newRestaurant?.name });
                
                if (isSliding) {
                    console.log('âŒ æ»‘å‹•è½‰å ´è¢«é˜»æ­¢:', { isSliding });
                    return;
                }

                const getCurrentImageUrl = () => {
                    if (finalRestaurant && finalRestaurant.image) return finalRestaurant.image;
                    return null;
                };

                const getNewImageUrl = () => {
                    if (newRestaurant && newRestaurant.image) return newRestaurant.image;
                    return null;
                };

                const currentImg = getCurrentImageUrl();
                const newImg = getNewImageUrl();

                console.log('ğŸ–¼ï¸ åœ–ç‰‡æª¢æŸ¥:', { currentImg, newImg });

                // åªæœ‰ç•¶åœ–ç‰‡ä¸åŒæ™‚æ‰åŸ·è¡Œæ»‘å‹•è½‰å ´
                if (currentImg === newImg) {
                    console.log('âŒ åœ–ç‰‡ç›¸åŒï¼Œä¸åŸ·è¡Œæ»‘å‹•è½‰å ´');
                    return;
                }

                console.log('âœ… é–‹å§‹æ»‘å‹•è½‰å ´å‹•ç•«');
                setCurrentImage(currentImg);
                setNextImage(newImg);
                setSlideDirection(direction);
                setIsSliding(true);

                // 300mså¾Œå®Œæˆå‹•ç•«
                setTimeout(() => {
                    console.log('âœ… æ»‘å‹•è½‰å ´å‹•ç•«å®Œæˆ');
                    setIsSliding(false);
                    setCurrentImage(null);
                    setNextImage(null);
                }, 300);
            }, [finalRestaurant, isSliding]);

            // ç›£è½finalRestaurantè®ŠåŒ–ï¼Œè§¸ç™¼æ»‘å‹•è½‰å ´
            const previousRestaurant = useRef(finalRestaurant);
            useEffect(() => {
                console.log('ğŸ¯ é¤å»³è®ŠåŒ–æª¢æŸ¥:', { 
                    previous: previousRestaurant.current?.name, 
                    current: finalRestaurant?.name
                });
                
                if (previousRestaurant.current !== finalRestaurant) {
                    console.log('âœ… è§¸ç™¼æ»‘å‹•è½‰å ´');
                    triggerSlideTransition(finalRestaurant, 'left');
                } else {
                    console.log('âŒ ä¸è§¸ç™¼æ»‘å‹•è½‰å ´');
                }
                previousRestaurant.current = finalRestaurant;
            }, [finalRestaurant, triggerSlideTransition]);

            // ä¸‹ä¸€å¼µåœ–ç‰‡
            const goToNextImage = () => {
                const nextIndex = (currentImageIndex + 1) % testImages.length;
                setCurrentImageIndex(nextIndex);
                setFinalRestaurant({
                    name: `æ¸¬è©¦é¤å»³ ${nextIndex + 1}`,
                    image: testImages[nextIndex]
                });
            };

            // ä¸Šä¸€å¼µåœ–ç‰‡
            const goToPrevImage = () => {
                const prevIndex = (currentImageIndex - 1 + testImages.length) % testImages.length;
                setCurrentImageIndex(prevIndex);
                setFinalRestaurant({
                    name: `æ¸¬è©¦é¤å»³ ${prevIndex + 1}`,
                    image: testImages[prevIndex]
                });
            };

            return (
                <div className="max-w-2xl mx-auto">
                    <h1 className="text-3xl font-bold text-center mb-8">ç°¡å–®æ»‘å‹•è½‰å ´æ¸¬è©¦</h1>
                    
                    {/* åœ–ç‰‡é¡¯ç¤ºå€åŸŸ */}
                    <div className="relative w-full h-64 mb-6 rounded-lg overflow-hidden bg-gray-200">
                        {/* æ»‘å‹•è½‰å ´å®¹å™¨ */}
                        {isSliding && (currentImage || nextImage) ? (
                            <div className="absolute inset-0 overflow-hidden">
                                {/* ç•¶å‰åœ–ç‰‡ - æ»‘å‡º */}
                                {currentImage && (
                                    <div 
                                        className="absolute inset-0 w-full h-full transition-transform duration-300 ease-out"
                                        style={{
                                            backgroundImage: `url(${currentImage})`,
                                            backgroundSize: 'cover',
                                            backgroundPosition: 'center',
                                            transform: slideDirection === 'left' ? 'translateX(-100%)' : 'translateX(100%)',
                                            zIndex: 1
                                        }}
                                    />
                                )}
                                {/* ä¸‹ä¸€å¼µåœ–ç‰‡ - å¾å³å´æ»‘å…¥ */}
                                {nextImage && (
                                    <div 
                                        className="absolute inset-0 w-full h-full"
                                        style={{
                                            backgroundImage: `url(${nextImage})`,
                                            backgroundSize: 'cover',
                                            backgroundPosition: 'center',
                                            transform: slideDirection === 'left' ? 'translateX(100%)' : 'translateX(-100%)',
                                            animation: slideDirection === 'left' ? 'slideInFromRight 300ms ease-out forwards' : 'slideInFromLeft 300ms ease-out forwards',
                                            zIndex: 2
                                        }}
                                    />
                                )}
                            </div>
                        ) : (
                            /* æ­£å¸¸é¡¯ç¤ºç‹€æ…‹ */
                            <div 
                                className="absolute inset-0"
                                style={{
                                    backgroundImage: `url(${finalRestaurant.image})`,
                                    backgroundSize: 'cover',
                                    backgroundPosition: 'center'
                                }}
                            />
                        )}
                        
                        {/* ç‹€æ…‹æŒ‡ç¤ºå™¨ */}
                        <div className="absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded">
                            {isSliding ? 'æ»‘å‹•ä¸­...' : finalRestaurant.name}
                        </div>
                    </div>
                    
                    {/* æ§åˆ¶æŒ‰éˆ• */}
                    <div className="flex justify-center gap-4">
                        <button 
                            onClick={goToPrevImage}
                            disabled={isSliding}
                            className="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            â† ä¸Šä¸€å¼µ
                        </button>
                        <button 
                            onClick={goToNextImage}
                            disabled={isSliding}
                            className="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            ä¸‹ä¸€å¼µ â†’
                        </button>
                    </div>
                    
                    {/* èªªæ˜ */}
                    <div className="mt-8 p-4 bg-blue-50 rounded-lg">
                        <h3 className="font-bold mb-2">æ¸¬è©¦èªªæ˜ï¼š</h3>
                        <ul className="list-disc list-inside space-y-1 text-sm">
                            <li>é»æ“ŠæŒ‰éˆ•æ¸¬è©¦æ»‘å‹•è½‰å ´æ•ˆæœ</li>
                            <li>æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°çš„èª¿è©¦ä¿¡æ¯</li>
                            <li>æ»‘å‹•éç¨‹ä¸­æŒ‰éˆ•æœƒè¢«ç¦ç”¨</li>
                            <li>å‹•ç•«æ™‚é•·ç‚º 300ms</li>
                        </ul>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SimpleSlideTest />, document.getElementById('root'));
    </script>
</body>
</html>

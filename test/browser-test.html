<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>瀏覽器語法測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div id="root">
        <div class="text-center">
            <h1 class="text-2xl font-bold mb-4">瀏覽器語法測試</h1>
            <div id="status" class="text-lg">載入中...</div>
        </div>
    </div>

    <script>
        console.log('🔍 開始瀏覽器測試...');
        
        // 模擬全局函數
        window.getPriceLabels = () => ({
            zh: { 1: '便宜', 2: '中等', 3: '昂貴', 4: '很貴' },
            en: { 1: 'Cheap', 2: 'Moderate', 3: 'Expensive', 4: 'Very Expensive' }
        });

        window.renderStars = (rating) => {
            if (!rating) return null;
            const stars = [];
            for (let i = 1; i <= 5; i++) {
                stars.push({
                    key: i,
                    className: i <= rating ? 'text-yellow-400' : 'text-gray-300',
                    symbol: '★'
                });
            }
            return stars;
        };

        window.getDirectionsUrl = (restaurant, userLocation, userAddress, language) => {
            return `https://www.google.com/maps/dir/?api=1&destination=${restaurant.name}`;
        };

        // 測試載入 SlotMachine.js
        fetch('/components/SlotMachine.js')
            .then(response => {
                console.log('📡 SlotMachine.js 響應狀態:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.text();
            })
            .then(code => {
                console.log('📄 SlotMachine.js 載入成功，大小:', code.length);
                
                // 嘗試用 Babel 轉換
                try {
                    const transformed = Babel.transform(code, {
                        presets: ['react']
                    });
                    console.log('✅ Babel 轉換成功');
                    
                    // 執行轉換後的代碼
                    eval(transformed.code);
                    
                    if (typeof window.SlotMachine === 'function') {
                        console.log('✅ SlotMachine 組件已定義');
                        
                        document.getElementById('root').innerHTML = `
                            <div class="text-center">
                                <h1 class="text-2xl font-bold mb-4 text-green-600">✅ 測試成功</h1>
                                <div class="space-y-2">
                                    <div class="text-green-600">✅ React 正常工作</div>
                                    <div class="text-green-600">✅ SlotMachine.js 載入成功</div>
                                    <div class="text-green-600">✅ Babel 轉換成功</div>
                                    <div class="text-green-600">✅ SlotMachine 組件已定義</div>
                                    <div class="text-green-600">✅ 滑動轉場效果已添加</div>
                                </div>
                                <div class="mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
                                    <strong>成功！</strong> SlotMachine 組件可以正常載入和使用
                                </div>
                            </div>
                        `;
                    } else {
                        throw new Error('SlotMachine 組件未定義');
                    }
                    
                } catch (babelError) {
                    console.error('❌ Babel 轉換失敗:', babelError);
                    document.getElementById('root').innerHTML = `
                        <div class="text-center">
                            <h1 class="text-2xl font-bold mb-4 text-red-600">❌ Babel 轉換失敗</h1>
                            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                                <strong>錯誤:</strong> ${babelError.message}
                            </div>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('❌ 載入失敗:', error);
                document.getElementById('root').innerHTML = `
                    <div class="text-center">
                        <h1 class="text-2xl font-bold mb-4 text-red-600">❌ 載入失敗</h1>
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                            <strong>錯誤:</strong> ${error.message}
                        </div>
                    </div>
                `;
            });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滑動吸附測試</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }
        
        .section-1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .slot-machine {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: 5px solid white;
            border-radius: 20px;
            position: relative;
        }
        
        .section-3 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debug">等待滑動...</div>
    
    <div class="section section-1">
        <div>上方區域<br>快速向下滑動測試</div>
    </div>
    
    <div class="section slot-machine" data-name="slot-machine">
        <div>🎰 老虎機區塊<br>目標定位點</div>
    </div>
    
    <div class="section section-3">
        <div>下方區域<br>快速向上滑動測試</div>
    </div>

    <script>
        // 簡化版滑動檢測 - 同時支援觸控和滑鼠
        class SimpleScrollSnap {
            constructor() {
                this.startY = null;
                this.startTime = null;
                this.isTracking = false;
                this.VELOCITY_THRESHOLD = 0.8; // 降低閾值便於測試
                this.MIN_DISTANCE = 50; // 最小距離
                
                this.bindEvents();
                this.log('初始化完成');
            }
            
            bindEvents() {
                // 觸控事件
                document.addEventListener('touchstart', (e) => this.onStart(e.touches[0].clientY), { passive: false });
                document.addEventListener('touchend', (e) => this.onEnd(e.changedTouches[0].clientY, e), { passive: false });
                
                // 滑鼠事件 (用於測試)
                document.addEventListener('mousedown', (e) => this.onStart(e.clientY), { passive: false });
                document.addEventListener('mouseup', (e) => this.onEnd(e.clientY, e), { passive: false });
            }
            
            onStart(y) {
                this.startY = y;
                this.startTime = Date.now();
                this.isTracking = true;
                this.log(`開始: Y=${this.startY}`);
            }
            
            onEnd(y, event) {
                if (!this.isTracking) return;
                
                const endY = y;
                const endTime = Date.now();
                
                const distance = Math.abs(endY - this.startY);
                const duration = endTime - this.startTime;
                const velocity = distance / duration;
                const direction = endY < this.startY ? '上' : '下';
                
                this.log(`滑動結束: 距離=${distance}px, 時間=${duration}ms, 速度=${velocity.toFixed(2)}px/ms, 方向=${direction}`);
                
                if (distance > this.MIN_DISTANCE && velocity > this.VELOCITY_THRESHOLD) {
                    this.log(`✅ 快速滑動檢測成功！阻止原生滾動並定位到老虎機`);
                    
                    // 阻止原生滾動
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // 延遲一點時間確保阻止生效
                    setTimeout(() => {
                        this.snapToTarget();
                    }, 10);
                } else {
                    this.log('慢速滑動，保持原生行為');
                }
                
                this.isTracking = false;
            }
            
            snapToTarget() {
                const target = document.querySelector('[data-name="slot-machine"]');
                if (!target) {
                    this.log('❌ 找不到目標元素');
                    return;
                }
                
                // 停止任何正在進行的滾動
                document.body.style.overflow = 'hidden';
                setTimeout(() => {
                    document.body.style.overflow = '';
                }, 50);
                
                const rect = target.getBoundingClientRect();
                const targetTop = rect.top + window.pageYOffset;
                
                this.log(`🎯 定位到老虎機: ${targetTop}px`);
                
                // 立即跳轉到目標位置
                window.scrollTo({
                    top: targetTop,
                    behavior: 'smooth'
                });
                
                // 確認滾動結果
                setTimeout(() => {
                    const currentScroll = window.pageYOffset;
                    this.log(`滾動完成: 當前位置=${currentScroll}px`);
                }, 500);
            }
            
            log(message) {
                console.log(message);
                const debug = document.getElementById('debug');
                if (debug) {
                    debug.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
                }
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            window.scrollSnap = new SimpleScrollSnap();
        });
    </script>
</body>
</html>